<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basket Progress Tracker - CUTM</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
        }
        
        /* Header Styles */
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
        }
        
        .header h1 { 
            color: #2c3e50; 
            font-size: 2.5em; 
            margin-bottom: 10px; 
            font-weight: 300;
        }
        
        .header p { 
            color: #6c757d; 
            font-size: 1.1em; 
        }
        
        /* Navigation */
        .nav-links {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .nav-links a {
            display: inline-block;
            padding: 10px 20px;
            margin: 0 10px;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        
        .nav-links a:hover {
            background: #495057;
            transform: translateY(-2px);
        }
        
        /* Filter Styles */
        .filters { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
            padding: 25px; 
            background: #f8f9fa; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-group { 
            display: flex; 
            flex-direction: column; 
        }
        
        .form-group label { 
            margin-bottom: 8px; 
            font-weight: 600; 
            color: #495057; 
        }
        
        .form-control { 
            padding: 12px; 
            border: 2px solid #e9ecef; 
            border-radius: 8px; 
            font-size: 14px; 
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus { 
            outline: none; 
            border-color: #667eea; 
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn { 
            padding: 15px 30px; 
            background: linear-gradient(45deg, #667eea, #764ba2); 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 500; 
            transition: all 0.3s ease;
        }
        
        .btn:hover { 
            background: linear-gradient(45deg, #5a6fd8, #6a3f8e); 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        /* Student Info Styles */
        .student-info { 
            background: linear-gradient(45deg, #667eea, #764ba2); 
            color: white; 
            padding: 25px; 
            border-radius: 10px; 
            margin-bottom: 30px; 
        }
        
        .student-details { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            text-align: center; 
        }
        
        .student-detail { 
            background: rgba(255,255,255,0.1); 
            padding: 15px; 
            border-radius: 8px; 
        }
        
        .student-detail strong {
            display: block;
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        /* Overall Stats */
        .overall-stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        
        .stat-card { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            text-align: center; 
            border-left: 5px solid #667eea; 
        }
        
        .stat-number { 
            font-size: 2em; 
            font-weight: bold; 
            color: #2c3e50; 
            display: block;
        }
        
        .stat-label { 
            color: #6c757d; 
            font-weight: 500; 
            margin-top: 5px; 
        }
        
        /* Requirements Summary */
        .requirements-summary {
            background: linear-gradient(45deg, #17a2b8, #20c997);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .requirement-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .requirement-item strong {
            display: block;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        /* Basket Cards */
        .baskets-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); 
            gap: 25px; 
        }
        
        .basket-card { 
            background: white; 
            border-radius: 10px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); 
            overflow: hidden; 
            transition: transform 0.3s ease;
        }
        
        .basket-card:hover {
            transform: translateY(-5px);
        }
        
        .basket-header { 
            background: #f8f9fa; 
            padding: 20px; 
            border-bottom: 2px solid #e9ecef; 
        }
        
        .basket-title { 
            font-size: 1.4em; 
            font-weight: bold; 
            color: #2c3e50; 
            margin-bottom: 15px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .basket-status {
            font-size: 0.8em;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: 500;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-not-started {
            background: #e2e3e5;
            color: #383d41;
        }
        
        /* Credit Progress */
        .credit-progress { 
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .credit-item { 
            background: rgba(102, 126, 234, 0.1);
            padding: 10px;
            border-radius: 5px;
        }
        
        .credit-number { 
            font-size: 1.2em;
            font-weight: bold; 
            color: #2c3e50; 
            display: block;
        }
        
        .credit-label { 
            font-size: 0.9em; 
            color: #6c757d; 
            margin-top: 3px;
        }
        
        .progress-bar { 
            background: #e9ecef; 
            height: 8px; 
            border-radius: 4px; 
            margin: 15px 0; 
            overflow: hidden; 
        }
        
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #56ab2f, #a8e6cf); 
            transition: width 0.5s ease; 
        }
        
        .progress-complete {
            background: linear-gradient(90deg, #28a745, #20c997) !important;
        }
        
        /* Default Assignment Styles */
        .default-assignment-warning {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 4px solid #ffc107;
            font-size: 0.9em;
        }

        .subject-default-assigned {
            background: #fff3cd !important;
        }

        .default-badge {
            background: #ffc107;
            color: #212529;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* Subjects Table - Simplified */
        .subjects-container {
            padding: 20px;
        }
        
        .subjects-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 20px; 
        }
        
        .subjects-table th { 
            background: #f8f9fa; 
            padding: 12px 8px; 
            text-align: left; 
            border-bottom: 2px solid #dee2e6; 
            font-size: 0.9em; 
            font-weight: 600;
            color: #495057;
        }
        
        .subjects-table td { 
            padding: 10px 8px; 
            border-bottom: 1px solid #dee2e6; 
            font-size: 0.9em; 
            vertical-align: middle;
        }
        
        .subjects-table tr:hover { 
            background: #f8f9fa; 
        }
        
        .subjects-table tr:nth-child(even) {
            background: #fafafa;
        }
        
        .subjects-table tr:nth-child(even):hover {
            background: #f0f0f0;
        }
        
        /* Completed Badge Only */
        .completed-badge { 
            background: #d4edda; 
            color: #155724; 
            padding: 4px 8px; 
            border-radius: 12px; 
            font-size: 0.8em; 
            font-weight: 500; 
            display: inline-block;
        }
        
        /* Simplified Notice */
        .simplified-notice {
            background: #e7f3ff;
            border-left: 4px solid #2196f3;
            color: #1565c0;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        
        /* Empty Basket Styles */
        .empty-basket {
            text-align: center;
            color: #6c757d;
            padding: 40px 20px;
            font-style: italic;
        }
        
        .empty-basket i {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }
        
        /* Alerts */
        .alert { 
            padding: 15px; 
            margin-bottom: 20px; 
            border-radius: 8px; 
        }
        
        .alert-error { 
            background-color: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        
        .alert-info { 
            background-color: #d1ecf1; 
            color: #0c5460; 
            border: 1px solid #bee5eb; 
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        /* Loading States */
        .loading {
            opacity: 0.7;
            pointer-events: none;
            position: relative;
        }
        
        .loading::after {
            content: ' Loading...';
            font-style: italic;
            color: #6c757d;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .filters { 
                grid-template-columns: 1fr; 
                padding: 20px;
            }
            
            .baskets-grid { 
                grid-template-columns: 1fr; 
            }
            
            .subjects-table { 
                font-size: 0.8em; 
            }
            
            .subjects-table th,
            .subjects-table td {
                padding: 6px 4px;
            }
            
            .credit-progress {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .student-details {
                grid-template-columns: 1fr;
            }
            
            .requirements-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .nav-links a {
                display: block;
                margin: 5px 0;
            }
        }
        
        @media (max-width: 480px) {
            .credit-progress {
                grid-template-columns: 1fr;
            }
            
            .overall-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
            }
            
            .container {
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            .btn, .nav-links, .filters {
                display: none;
            }
        }
        
        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🎯 Basket Progress Tracker</h1>
            <p>Track your CBCS progress - <strong>Completed Subjects Only</strong></p>
        </div>

        <!-- Simplified Notice -->
        <div class="simplified-notice">
            <strong>📢 Simplified View:</strong> This system shows only completed subjects and their earned credits. 
            No grades or pending subjects are displayed - just clear progress tracking based on completion.
        </div>

        <!-- Navigation Links -->
        <div class="nav-links">
            <a href="/basket">← Back to Baskets</a>
            <a href="/">Main Dashboard</a>
            <a href="/data">Data Management</a>
        </div>

        <!-- Filter Form -->
        <form method="POST" id="filterForm">
            <div class="filters">
                <div class="form-group">
                    <label for="department">Department:</label>
                    <select name="department" id="department" class="form-control" onchange="loadRegistrations()">
                        <option value="">Select Department</option>
                        <option value="All" {% if filters.department == 'All' %}selected{% endif %}>All Departments</option>
                        <option value="Civil Engineering" {% if filters.department == 'Civil Engineering' %}selected{% endif %}>Civil Engineering</option>
                        <option value="Computer Science Engineering" {% if filters.department == 'Computer Science Engineering' %}selected{% endif %}>Computer Science Engineering</option>
                        <option value="Electronics & Communication Engineering" {% if filters.department == 'Electronics & Communication Engineering' %}selected{% endif %}>Electronics & Communication Engineering</option>
                        <option value="Electrical & Electronics Engineering" {% if filters.department == 'Electrical & Electronics Engineering' %}selected{% endif %}>Electrical & Electronics Engineering</option>
                        <option value="Mechanical Engineering" {% if filters.department == 'Mechanical Engineering' %}selected{% endif %}>Mechanical Engineering</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="batch">Batch (Year):</label>
                    <select name="batch" id="batch" class="form-control">
                        <option value="">Select Batch</option>
                        <option value="All" {% if filters.batch == 'All' %}selected{% endif %}>All Batches</option>
                        <option value="20" {% if filters.batch == '20' %}selected{% endif %}>2020 (20)</option>
                        <option value="21" {% if filters.batch == '21' %}selected{% endif %}>2021 (21)</option>
                        <option value="22" {% if filters.batch == '22' %}selected{% endif %}>2022 (22)</option>
                        <option value="23" {% if filters.batch == '23' %}selected{% endif %}>2023 (23)</option>
                        <option value="24" {% if filters.batch == '24' %}selected{% endif %}>2024 (24)</option>
                        <option value="25" {% if filters.batch == '25' %}selected{% endif %}>2025 (25)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="registration">Registration No:</label>
                    <input type="text" name="registration" id="registration" class="form-control" 
                           placeholder="Enter Registration Number (e.g., 21CUTM1234567890)"
                           value="{{ filters.registration or '' }}" onchange="loadSemesters()">
                </div>
                
                <div class="form-group">
                    <label for="semester">Semester:</label>
                    <select name="semester" id="semesterSelect" class="form-control" multiple>
                        <option value="">Select Semester</option>
                        <option value="All">All Semesters</option>
                        {% if filters.semester %}
                            {% for semester in filters.semester %}
                                <option value="{{ semester }}" selected>{{ semester }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="basket">Basket:</label>
                    <select name="basket" id="basketSelect" class="form-control">
                        <option value="">Select Basket</option>
                        <option value="All">All Baskets</option>
                        <option value="Basket I" {% if filters.basket == 'Basket I' %}selected{% endif %}>Basket I (17 Credits)</option>
                        <option value="Basket II" {% if filters.basket == 'Basket II' %}selected{% endif %}>Basket II (12 Credits)</option>
                        <option value="Basket III" {% if filters.basket == 'Basket III' %}selected{% endif %}>Basket III (25 Credits)</option>
                        <option value="Basket IV" {% if filters.basket == 'Basket IV' %}selected{% endif %}>Basket IV (58 Credits)</option>
                        <option value="Basket V" {% if filters.basket == 'Basket V' %}selected{% endif %}>Basket V (48 Credits)</option>
                    </select>
                </div>
            </div>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <button type="submit" class="btn">🔍 Track Progress</button>
                <button type="button" class="btn btn-secondary" onclick="clearFilters()" style="margin-left: 10px;">🗑️ Clear Filters</button>
            </div>
        </form>

        <!-- Error Messages -->
        {% if error %}
        <div class="alert alert-error">
            <strong>❌ Error:</strong> {{ error }}
        </div>
        {% endif %}

        <!-- Results Section -->
        {% if search_performed and student_data %}
            <!-- Student Information -->
            <div class="student-info fade-in">
                <h3 style="text-align: center; margin-bottom: 20px;">📋 Student Information</h3>
                <div class="student-details">
                    <div class="student-detail">
                        <strong>{{ student_data.name or 'Unknown' }}</strong>
                        <div>Name</div>
                    </div>
                    <div class="student-detail">
                        <strong>{{ student_data.registration or 'Unknown' }}</strong>
                        <div>Registration No</div>
                    </div>
                    <div class="student-detail">
                        <strong>{{ student_data.department or 'Unknown' }}</strong>
                        <div>Department</div>
                    </div>
                    <div class="student-detail">
                        <strong>{{ student_data.overall_stats.overall_status or 'Unknown' }}</strong>
                        <div>Overall Status</div>
                    </div>
                </div>
            </div>

            <!-- Overall Statistics -->
            <div class="overall-stats fade-in">
                <div class="stat-card">
                    <span class="stat-number">{{ student_data.overall_stats.baskets_completed or 0 }}/{{ student_data.overall_stats.total_baskets or 5 }}</span>
                    <div class="stat-label">Baskets Completed</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ student_data.overall_stats.total_earned_credits or 0 }}</span>
                    <div class="stat-label">Total Earned Credits</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{  160 }}</span>
                    <div class="stat-label">Total Required Credits</div>
                </div>
                <div class="stat-card">
                    <span class="stat-number">{{ student_data.overall_stats.percentage or 0 }}%</span>
                    <div class="stat-label">Overall Progress</div>
                </div>
            </div>

            <!-- Credit Requirements Summary -->
            <div class="requirements-summary fade-in">
                <h3>🎓 CBCS Credit Requirements</h3>
                <div class="requirements-grid">
                    <div class="requirement-item">
                        <strong>Basket I</strong>
                        <div>17 Credits</div>
                    </div>
                    <div class="requirement-item">
                        <strong>Basket II</strong>
                        <div>12 Credits</div>
                    </div>
                    <div class="requirement-item">
                        <strong>Basket III</strong>
                        <div>25 Credits</div>
                    </div>
                    <div class="requirement-item">
                        <strong>Basket IV</strong>
                        <div>58 Credits</div>
                    </div>
                    <div class="requirement-item">
                        <strong>Basket V</strong>
                        <div>48 Credits</div>
                    </div>
                </div>
                <div style="margin-top: 20px; font-size: 1.2em;">
                    <strong>Total Required: 160 Credits</strong>
                </div>
            </div>

            <!-- Basket Progress Cards - Only Completed Subjects -->
            <div class="baskets-grid fade-in">
                {% for basket_name, basket_info in basket_progress.items() %}
                <div class="basket-card">
                    <div class="basket-header">
                        <div class="basket-title">
                            {{ basket_name or 'Unknown Basket' }}
                            <span class="basket-status {% if basket_info.is_completed %}status-completed{% elif basket_info.status == 'Not Started' %}status-not-started{% else %}status-pending{% endif %}">
                                {{ basket_info.status or 'Unknown' }}
                            </span>
                        </div>
                        
                        <!-- Warning for default-assigned subjects -->
                        {% if basket_info.has_default_subjects %}
                        <div class="default-assignment-warning">
                            ⚠️ <strong>Note:</strong> {{ basket_info.default_assigned_count or 0 }} subject(s) automatically assigned to this basket (not originally categorized)
                        </div>
                        {% endif %}
                        
                        <!-- Credit Progress Display -->
                        <div class="credit-progress">
                            <div class="credit-item">
                                <span class="credit-number">{{ basket_info.earned_credits or 0 }}</span>
                                <div class="credit-label">Earned</div>
                            </div>
                            <div class="credit-item">
                                <span class="credit-number">{{ basket_info.required_credits or 0 }}</span>
                                <div class="credit-label">Required</div>
                            </div>
                            <div class="credit-item">
                                <span class="credit-number">{{ basket_info.pending_credits or 0 }}</span>
                                <div class="credit-label">Pending</div>
                            </div>
                            <div class="credit-item">
                                <span class="credit-number">{{ basket_info.percentage or 0 }}%</span>
                                <div class="credit-label">Progress</div>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="progress-bar">
                            <div class="progress-fill {% if (basket_info.percentage or 0) >= 100 %}progress-complete{% endif %}" 
                                 style="width: {{ basket_info.percentage or 0 }}%" 
                                 title="{{ basket_info.earned_credits or 0 }}/{{ basket_info.required_credits or 0 }} credits">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Subjects List - Only Completed Subjects -->
                    <div class="subjects-container">
                        {% set completed_subjects = basket_info.subjects | selectattr('completed') | list %}
                        {% if completed_subjects %}
                        <table class="subjects-table">
                            <thead>
                                <tr>
                                    <th>Subject Code</th>
                                    <th>Subject Name</th>
                                    <th>Credits</th>
                                    <th>Status</th>
                                    <th>Semester</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for subject in completed_subjects %}
                                <tr {% if subject.is_default_assigned %}class="subject-default-assigned"{% endif %}>
                                    <td>
                                        <strong>{{ subject.code or 'Unknown' }}</strong>
                                        {% if subject.is_default_assigned %}
                                        <span class="default-badge">AUTO</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ subject.name or 'Unknown Subject' }}</td>
                                    <td><strong>{{ subject.credits or 0 }}</strong></td>
                                    <td>
                                        <span class="completed-badge">✓ Completed</span>
                                    </td>
                                    <td>{{ subject.semester or '-' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        
                        <!-- Summary -->
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin-top: 15px;">
                            <strong>📊 Summary:</strong> {{ completed_subjects|length }} completed subjects contributing {{ basket_info.earned_credits or 0 }} credits to this basket
                        </div>
                        
                        {% else %}
                        <div class="empty-basket">
                            <i>📚</i>
                            <p><strong>No completed subjects in this basket yet</strong></p>
                            <small>Completed subjects will appear here once records are available</small>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Simplified System Explanation -->
            <div class="alert alert-info fade-in" style="margin-top: 20px;">
                <strong>🔍 Simplified Tracking System:</strong><br>
                <ul style="margin-top: 10px; text-align: left;">
                    <li><strong>Display:</strong> Only completed subjects are shown</li>
                    <li><strong>No Grades:</strong> Grade information is not displayed</li>
                    <li><strong>No Pending:</strong> Incomplete/pending subjects are hidden</li>
                    <li><strong>Clean View:</strong> Focus on achievements and progress only</li>
                    {% if student_data.overall_stats.default_assigned_subjects > 0 %}
                    <li><strong>Auto-Assignment:</strong> {{ student_data.overall_stats.default_assigned_subjects }} subject(s) automatically assigned to Basket V (marked with "AUTO" badge)</li>
                    {% endif %}
                </ul>
            </div>

        {% elif search_performed %}
            <div class="alert alert-info fade-in">
                <strong>🔍 No Completed Subjects Found</strong><br>
                No completed subjects found for the selected criteria. Please verify the registration number and try again.
            </div>

        {% else %}
            <div class="alert alert-info fade-in">
                <strong>🎯 Welcome to Simplified Basket Progress Tracker!</strong><br>
                This system shows only completed subjects without grades or pending items.
                <br><br>
                <strong>Key Features:</strong>
                <ul style="margin-top: 10px; text-align: left;">
                    <li>✅ Shows only completed subjects</li>
                    <li>🚫 No grade information displayed</li>
                    <li>🚫 No pending/incomplete subjects shown</li>
                    <li>📊 Clean progress tracking</li>
                    <li>📱 Mobile-responsive interface</li>
                </ul>
            </div>
        {% endif %}
    </div>

    <!-- JavaScript -->
    <script>
        // Clear all filters function
        function clearFilters() {
            document.getElementById('filterForm').reset();
            document.getElementById('department').value = '';
            document.getElementById('batch').value = '';
            document.getElementById('registration').value = '';
            document.getElementById('semesterSelect').innerHTML = '<option value="">Select Semester</option><option value="All">All Semesters</option>';
            document.getElementById('basketSelect').innerHTML = '<option value="">Select Basket</option><option value="All">All Baskets</option>';
            
            loadBaskets();
        }

        function loadRegistrations() {
            const department = $('#department').val();
            if (department && department !== 'All') {
                console.log('Department selected:', department);
            }
        }

        function loadSemesters() {
            const registration = $('#registration').val();
            const semesterSelect = $('#semesterSelect');
            
            if (registration && registration !== 'All' && registration.trim() !== '') {
                semesterSelect.addClass('loading');
                
                fetch('/ajax/get_semesters', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    body: `registration=${encodeURIComponent(registration)}`
                })
                .then(response => response.text())
                .then(data => {
                    semesterSelect.html(data);
                    semesterSelect.removeClass('loading');
                })
                .catch(error => {
                    console.error('Error loading semesters:', error);
                    semesterSelect.removeClass('loading');
                    semesterSelect.html('<option value="">Error loading semesters</option>');
                });
            }
        }

        function loadBaskets() {
            const basketSelect = $('#basketSelect');
            basketSelect.addClass('loading');
            
            fetch('/ajax/get_baskets', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: ''
            })
            .then(response => response.text())
            .then(data => {
                basketSelect.html(data);
                basketSelect.removeClass('loading');
            })
            .catch(error => {
                console.error('Error loading baskets:', error);
                basketSelect.removeClass('loading');
                basketSelect.html('<option value="">Error loading baskets</option>');
            });
        }

        // Form submission with loading state
        $('#filterForm').on('submit', function(e) {
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '⏳ Searching...';
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            
            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
            }, 10000);
        });

        // Page load initialization
        $(document).ready(function() {
            loadBaskets();
            
            // Registration number validation
            $('#registration').on('blur', function() {
                const regNo = $(this).val().trim();
                if (regNo && regNo.length > 0) {
                    if (!/^[0-9]{2}CUTM[0-9]{10}$/.test(regNo)) {
                        $(this).css('border-color', '#dc3545');
                        $(this).attr('title', 'Expected format: 21CUTM1234567890 (Year + CUTM + 10 digits)');
                    } else {
                        $(this).css('border-color', '#28a745');
                        $(this).removeAttr('title');
                    }
                }
            });
            
            // Animate progress bars with error handling
            setTimeout(() => {
                $('.progress-fill').each(function() {
                    const $this = $(this);
                    const width = $this.css('width');
                    
                    if (width && width !== '0px') {
                        $this.css('width', '0%').animate({width: width}, {
                            duration: 1500,
                            step: function(now) {
                                $(this).attr('data-percentage', Math.round(now));
                            }
                        });
                    }
                });
            }, 500);
        });

        // Keyboard shortcuts
        $(document).on('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'Enter':
                        e.preventDefault();
                        $('#filterForm').submit();
                        break;
                    case 'r':
                        e.preventDefault();
                        location.reload();
                        break;
                    case 'k':
                        e.preventDefault();
                        clearFilters();
                        break;
                }
            }
            
            if (e.key === 'Escape') {
                $('#registration').val('').focus();
            }
        });

        // Print functionality
        function printReport() {
            $('body').addClass('printing');
            window.print();
            $('body').removeClass('printing');
        }

        // Add print button if results exist
        {% if search_performed and student_data %}
        $(document).ready(function() {
            const printBtn = $('<button class="btn" style="margin: 10px;">🖨️ Print Report</button>');
            printBtn.click(printReport);
            $('.nav-links').append(printBtn);
        });
        {% endif %}
    </script>
</body>
</html>
